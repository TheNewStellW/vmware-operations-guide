---
title: "4. 小測驗時間!"
date: 2021-06-15T10:18:00+10:00
draft: false
weight: 40
---

到現在為止，我希望您意識到 4 個關鍵對象（來賓操作系統、ESXi 和集群）中的各種“利用率”衡量指標各不相同。每個人都有自己獨特的行為。因此，您可以正確地假設它們不能很好地跨堆棧映射。讓我們用一個例子來測試你的知識。

## 來賓操作系統

仔細查看以下圖表。這是我運行 Windows 10 的物理桌面。 CPU 有 1 個插槽 4 核 8 線程，因此 Windows 可以看到 8 個邏輯處理器。您可以看到 Microsoft Word 沒有響應，因為其窗口變灰。任務管理器通過顯示 3 個文檔都沒有響應來確認這一點。 Word 也消耗非常高的功率，如功率使用列中所示。

它變得無響應，因為我在 400 頁的文檔上打開了更改跟踪並刪除了數百頁。它必須做很多處理，它不喜歡那樣。不幸的是，在那之後我無法重現該問題。

在操作系統方面，Windows 反應良好。我能夠關閉所有其他應用程序，並啟動任務管理器和 Snip 程序。我懷疑是因為 Word 不會消耗所有 CPU。因此，如果我們在 Windows 級別進行跟踪，我們將 **不會** 意識到存在問題。這就是為什麼如果要監視應用程序，進程級監視很重要的原因。具體到掛起狀態，我們應該監控狀態而不是簡單的CPU消耗。

在 Windows 任務欄中，除了 Microsoft Word 和任務管理器之外，沒有其他應用程序在運行。你能猜出為什麼 Windows 級別的 CPU 利用率高於其進程的總和嗎？我對為什麼 Windows 顯示 57% 而 Word 顯示 18.9% 的猜測是 Turbo Boost。單個進程級別的 CPU 計數器不會考慮它，而操作系統級別的計數器會考慮。

![Windows 任務管理器](2.2.4-fig-1.png)

我把它放了 15 分鐘，什麼都沒有改變。所以並不是說它需要更多時間來處理更改。我懷疑它遇到了 CPU 鎖定，因此運行 Microsft Word 的 CPU 正在 100% 運行。由於 Windows 總體上僅報告 57%，因此跟踪 Windows CPU 中的峰值很重要。這就是 vRealize Operations 在 VM vCPU 中提供峰值的原因。

## 虛擬機與 ESXi

仔細查看以下圖表。必要時放大。

![VM 利用率計數器](2.2.4-fig-2.png)

上面的 vCenter 圖表 [^1] 顯示了 VM 利用率計數器。這是一個帶有 24 個 vCPU 運行受控 CPU 測試的大型 VM。電源管理是固定的，因此它以標稱時鐘速度運行。這消除了 CPU 頻率縮放因子。

它從 50% 的“利用率”開始，每個 vCPU 固定到不同的物理核心。然後它會隨著時間緩慢上升，直到達到 100%。

你能弄清楚為什麼三個計數器的上升方式不同嗎？他們測量什麼？

現在讓我們看看對父 ESXi 的影響。它只有一個 VM，但 VM vCPU 與 ESXi 物理內核匹配。 ESXi 以 50% 的“利用率”開始，然後隨著時間的推移緩慢上升，直到達到 100%。

![使用率飆升](2.2.4-fig-3.png)

你能弄清楚為什麼 3 個計數器的上升方式不同嗎？他們測量什麼？像往常一樣，答案可以在 [部分 4](/zh/miscellaneous/chapter-1-quiz-answers/).

## ESXi 利用率與爭用

ESXi“利用率”與 ESXi“爭用”無關。 4 個突出顯示的區域是衡量指標不相關的例子，其中一些甚至相反。你能猜到為什麼嗎？

![爭用與使用](2.2.4-fig-4.png)

像往常一樣，回答 [部分 4](/zh/miscellaneous/chapter-1-quiz-answers/).

[^1]: 由...提供 Valentin Bondzio