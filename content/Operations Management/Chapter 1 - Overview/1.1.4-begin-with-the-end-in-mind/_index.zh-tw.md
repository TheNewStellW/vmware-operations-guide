---
title: "4. 開始思考如何結束"
date: 2021-06-11T11:31:22+10:00
draft: false
---

對我來說，架構是第一天，運營是第二天。第 1 天發生在第 2 天之前。架構是指詳細的工作，包括構建和調試系統。雖然高級市場結構 [^1] 是在第 0 天（規劃）定義的，但真正的架構工作是在第 1 天完成的。

但是，如果我們深入思考，第 2 天會影響第 0 天，這就是計劃。原因是最終狀態驅動您的計劃。您的計劃驅動您的架構。所以它是 2 -> 0 -> 1，而不是 0 -> 1 -> 2。

![第 0 天、第 1 天和第 2 天的流程圖](1.1.4-fig-1.png)

讓我們用一個例子來說明第 2 天如何影響第 0 天，進而影響第 1 天。

假設您是內部雲提供商併計劃按 VM 收費。您計劃提供兩種類型的產品：

- **金牌**：適用於生產工作負載。性能優化。
- **銀**：適用於非生產工作負載。成本優化。

對於 金子，您計劃不過度使用 CPU 和 RAM。如果 1 個 CPU 通常使用 4 GB RAM，那麼 40 核 ESXi 主機將只需要 160 GB。如果您購買具有 1 TB RAM 的主機，那麼您最終可能無法出售剩餘的 864 GB，因為您沒有可出售的 vCPU。這意味著您的硬件規格會受到影響。這是第 2 天如何影響第 0 天的示例。

對於 銀，您計劃為 CPU 過量使用 4:1，為內存過量使用 2:1。

- 您假設 1 個 vCPU 通常使用 4 GB RAM。您的客戶可以購買更多或更少的內存，因此 CPU 和 RAM 之間的 4:1 比率只是您的規劃指南。
- 您計劃使用重複數據刪除 + NSX + vSphere Replication 來運行 vSAN。您還需要大量 IO VM，這需要內核處理。對於所有這些支持的非業務工作負載，您分配了 8 個內核和 64 GB RAM。
-如果您購買 64 核 ESXi，剩餘 56 核，您將能夠銷售 224 個 vCPU。
- 這 224 個 vCPU 將需要 896 GB RAM。由於您過量使用 2:1，因此 VM 需要 448 GB。您需要的總 RAM 為 448 + 64 = 512 GB。
- 這意味著您需要的硬件規格是 64 核和 512 GB RAM。如果您購買的 RAM 超過此數量，您可能無法出售這些額外的 RAM，因為您可能沒有 vCPU 伴隨它們。

以上 2 個示例展示瞭如何在不考慮平均 VM 配置文件和計劃的過載率的情況下確定硬件規格。

您還在研究黃金可用區的概念，因為它們託管關鍵任務業務服務。您公司的 [業務連續性](https://en.wikipedia.org/wiki/Business_continuity_planning) 政策規定，如果整個集群發生故障，您計劃限制受影響的 VM 數量。如果您限制為 300 個生產虛擬機，那麼您的集群大小不應太大，因為您將無法充分利用資源。我見過許多運行 1000-2000 個虛擬機的 32 節點生產集群。

在您的服務產品中，您可以讓客戶檢查自己的 VM 運行狀況，以及底層平台如何為他們的 VM 提供服務。這意味著您的架構需要知道如何將租戶與其虛擬機相關聯。您需要有一個標記標準，例如業務單位、部門、聯繫人姓名。

您的 CIO 希望向他的同事提供實時信息，以了解 IT 如何為業務服務。這需要您考慮關鍵績效指標[KPI](/operations-management/chapter-1-overview/1.1.8-pillar-vs-process/) (KPI)[^2]. 您如何知道IaaS 對其消費者而言執行得足夠快？您如何證明您符合服務水平協議 [SLA](/operations-management/chapter-1-overview/1.1.7-service-level-agreement/) (SLA) 你承諾了？

![服務層圖](1.1.4-fig-2.png)

從性能管理的角度來看，vSphere 集群是資源的最小邏輯構建塊。雖然資源池和 VM 主機關聯可以提供更小的切片，但它們操作複雜，無法提供承諾的 IaaS 服務質量。資源池無法提供差異化​​的服務類別。例如，您的 SLA 規定黃金的速度是白銀的兩倍，因為它的收費高 200%。資源池可以給Gold兩倍的份額。無法提前確定這些額外的份額是否會轉化為一半的 CPU 就緒狀態。

在您的運營中反映您的業務非常重要。創建一個層次結構，運營團隊和租戶可以在其中輕鬆找到相關的 VM。這些用戶將由業務應用程序驅動，因此您的 IaaS 需要圍繞此進行設計。以下結構將業務單位顯示為頂級文件夾。每個業務單元可以有 1 個或多個部門（業務單元 C 跨越下圖中的 3 個部門）。每個部門都有多個業務應用程序。業務應用通常由多層組成（例如，Web 層、應用層、數據庫層）。

![部門和服務水平細分](1.1.4-fig-3.png)

上述限制為重組。您需要重命名，將文件夾移動到新的父文件夾並刪除該文件夾。例如，如果業務單位 B 與業務單位 C 合併，並且合併的實體有一個新名稱，則需要重命名並刪除另一個名稱。

最後但並非最不重要的是，您需要考慮問題。真正的問題發生在第 2 天，因為當時您有一個用於創收交易的業務工作負載。不要設計你不想解決的問題。考慮運行您的架構所需的角色和技能。為每個組件提供必要的可見性 [^3]，並定義構成健康、風險和效率的內容。

我希望上面的例子表明第 2 天是您想要開始的地方。從頭到尾，有句名言 [引用](https://www.franklincovey.com/the-7-habits/habit-2/).

您是否注意到上述討論中遺漏了什麼？

是的，我沒有涵蓋 **自動化**。

這是為什麼？

對我來說，那是建築的一部分。你不應該自動化你無法操作的事情。因此，自動化不是運營的一部分。自動化是您架構的一個特性，這意味著您在設計系統時已經考慮了自動化。例如，它就像一架具有許多自動化功能的飛機。有線飛行。這是飛機的特點。如何操作飛機，讓乘客安全、舒適、準時到達目的地，這就是操作。

[^1]：營銷結構。對缺乏細節的基於 PowerPoint 的圖表的簡單參考。
[^2]：我理解SLI、SLO、SLA、KAI和KPI的區別。出於 PCMCIA 的原因（人們無法管理計算機行業首字母縮略詞），不使用 SLI 和 SLO。精度很好。但是使用過多的行話會增加複雜性。
[^3]：有些人使用了可觀察性這個術語，並導致與監控不必要的混淆。這是 PCMCIA 的另一個例子。如果我們真的要分開頭髮，那麼可調試性這個詞就更有價值了，因為可以觀察到系統並不意味著它是可調試的。